# æ•°æ®æºæ£€æŸ¥æŠ¥å‘Š

> **æ£€æŸ¥æ—¥æœŸ**: 2025-11-07  
> **æ£€æŸ¥è„šæœ¬**: `scripts/check_data_source.py`

## æ£€æŸ¥ç»“æžœ

### âœ… æ•°æ®ç›®å½•å­˜åœ¨

- **é¢„è§ˆç›®å½•**: `deploy/data/ofi_cvd/preview` âœ…
- **Parquet æ–‡ä»¶æ€»æ•°**: 54,864 ä¸ª
- **ç‰¹å¾æ–‡ä»¶ (kind=features)**: 11,082 ä¸ª Parquet æ–‡ä»¶
- **JSONL æ–‡ä»¶**: 0 ä¸ª

### âš ï¸ å‘çŽ°çš„é—®é¢˜

#### 1. æ–‡ä»¶æ ¼å¼ä¸åŒ¹é…

**é—®é¢˜**:
- Signal Server åªæ”¯æŒ JSONL æ ¼å¼ï¼ˆä»£ç ä¸­åªæŸ¥æ‰¾ `*.jsonl`ï¼‰
- å®žé™…ç‰¹å¾æ–‡ä»¶æ˜¯ Parquet æ ¼å¼

**å½±å“**:
- Signal Server æ— æ³•è¯»å–ç‰¹å¾æ–‡ä»¶
- å¯¼è‡´ `total=0` å’Œ `QUIET_RUN` è­¦å‘Š

**ä½ç½®**:
- `mcp/signal_server/app.py` ç¬¬ 63ã€113 è¡Œï¼šåªæŸ¥æ‰¾ `*.jsonl` æ–‡ä»¶

#### 2. è·¯å¾„ç»“æž„ä¸åŒ¹é…

**é—®é¢˜**:
- Orchestrator é…ç½®çš„è¾“å…¥è·¯å¾„ï¼š`preview/features/`
- å®žé™…è·¯å¾„ç»“æž„ï¼š`preview/date=YYYY-MM-DD/hour=HH/symbol=xxx/kind=features/`

**å½±å“**:
- Signal Server æ— æ³•æ‰¾åˆ°ç‰¹å¾æ–‡ä»¶
- å³ä½¿æ”¯æŒ Parquetï¼Œè·¯å¾„ä¹Ÿä¸å¯¹

**ä½ç½®**:
- `orchestrator/run.py` ç¬¬ 761 è¡Œï¼š`features_dir = project_root / "deploy" / "data" / "ofi_cvd" / "preview" / "features"`

### ðŸ“Š æ•°æ®ç»Ÿè®¡

- **æœ€æ–°æ–‡ä»¶**: `part-1762511912000-1762511967000-39-98c75cf8.parquet`
- **æœ€æ–°ä¿®æ”¹æ—¶é—´**: 2025-11-07 18:39:30
- **æœ€è¿‘ 10 åˆ†é’Ÿæ–‡ä»¶**: 144 ä¸ª
- **æ–‡ä»¶å¹´é¾„**: 2161-2170 åˆ†é’Ÿï¼ˆçº¦ 36 å°æ—¶å‰ï¼‰

### ðŸ“ ç›®å½•ç»“æž„

```
preview/
â”œâ”€â”€ date=2025-11-05/
â”‚   â””â”€â”€ hour=22-23/
â”‚       â””â”€â”€ symbol=xxx/
â”‚           â””â”€â”€ kind=features/
â”‚               â””â”€â”€ *.parquet
â”œâ”€â”€ date=2025-11-06/
â”‚   â””â”€â”€ hour=00-23/
â”‚       â””â”€â”€ symbol=xxx/
â”‚           â””â”€â”€ kind=features/
â”‚               â””â”€â”€ *.parquet
â””â”€â”€ date=2025-11-07/
    â””â”€â”€ hour=00-10/
        â””â”€â”€ symbol=xxx/
            â””â”€â”€ kind=features/
                â””â”€â”€ *.parquet
```

**Symbols**: BNBUSDT, BTCUSDT, DOGEUSDT, ETHUSDT, SOLUSDT, XRPUSDT

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: æ›´æ–° Signal Server æ”¯æŒ Parquetï¼ˆæŽ¨èï¼‰

**ä¿®æ”¹**:
1. æ›´æ–° `mcp/signal_server/app.py` æ”¯æŒè¯»å– Parquet æ–‡ä»¶
2. ä½¿ç”¨ `pandas` æˆ– `pyarrow` è¯»å– Parquet
3. è½¬æ¢ä¸ºå­—å…¸æ ¼å¼ä¾› CoreAlgorithm å¤„ç†

**ä¼˜ç‚¹**:
- ç›´æŽ¥ä½¿ç”¨çŽ°æœ‰æ•°æ®
- ä¸éœ€è¦è½¬æ¢æ­¥éª¤
- æ€§èƒ½æ›´å¥½ï¼ˆParquet åŽ‹ç¼©ï¼‰

### æ–¹æ¡ˆ 2: æ›´æ–° Orchestrator è·¯å¾„é…ç½®

**ä¿®æ”¹**:
- å°† `features_dir` æ”¹ä¸º `preview/`ï¼ˆè€Œä¸æ˜¯ `preview/features/`ï¼‰
- Signal Server çš„ `rglob` ä¼šè‡ªåŠ¨é€’å½’æŸ¥æ‰¾

**ä¼˜ç‚¹**:
- ç®€å•å¿«é€Ÿ
- ä½†ä»éœ€è§£å†³ Parquet æ ¼å¼é—®é¢˜

### æ–¹æ¡ˆ 3: æ·»åŠ  Parquet åˆ° JSONL è½¬æ¢æ­¥éª¤

**ä¿®æ”¹**:
- åœ¨ Harvest å’Œ Signal ä¹‹é—´æ·»åŠ è½¬æ¢æœåŠ¡
- è¯»å– Parquet å¹¶è½¬æ¢ä¸º JSONL

**ç¼ºç‚¹**:
- å¢žåŠ ç³»ç»Ÿå¤æ‚åº¦
- éœ€è¦é¢å¤–å­˜å‚¨ç©ºé—´

## å»ºè®®

**ç«‹å³è¡ŒåŠ¨**:
1. âœ… æ›´æ–° `orchestrator/run.py` ä¸­çš„ `features_dir` è·¯å¾„ä¸º `preview/`
2. âœ… æ›´æ–° `mcp/signal_server/app.py` æ”¯æŒ Parquet æ–‡ä»¶è¯»å–

**ä»£ç ä¿®æ”¹ç¤ºä¾‹**:

```python
# orchestrator/run.py
features_dir = project_root / "deploy" / "data" / "ofi_cvd" / "preview"  # ç§»é™¤ /features

# mcp/signal_server/app.py
import pandas as pd

def iter_feature_rows(source, symbols):
    # æ”¯æŒ Parquet æ–‡ä»¶
    if path.is_dir():
        candidates = sorted(path.rglob("*.parquet")) + sorted(path.rglob("*.jsonl"))
    # ...
    for file_path in candidates:
        if file_path.suffix == ".parquet":
            df = pd.read_parquet(file_path)
            for _, row in df.iterrows():
                record = row.to_dict()
                yield record
        elif file_path.suffix == ".jsonl":
            # çŽ°æœ‰ JSONL å¤„ç†é€»è¾‘
```

## éªŒè¯

ä¿®å¤åŽè¿è¡Œï¼š
```powershell
python scripts/check_data_source.py
```

é¢„æœŸç»“æžœï¼š
- âœ… æ‰¾åˆ° Parquet æ–‡ä»¶
- âœ… Signal Server å¯ä»¥è¯»å–
- âœ… ç”Ÿæˆä¿¡å·ï¼ˆ`total > 0`ï¼‰

