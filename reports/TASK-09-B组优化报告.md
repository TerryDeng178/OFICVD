# TASK-09 B组优化报告

**组别**: B组（冷却 + 反向防抖）  
**目标**: 减少"刚出又反手"的快速反转交易，交易频率下降≥40%，平均持仓增加≥100%  
**报告时间**: 2025-11-10

---

## 一、组别定位与策略

### 1.1 核心策略
B组专注于**冷却 + 反向防抖**，通过以下手段减少快速反转交易：
- **回测端重算融合**: 启用`recompute_fusion`，确保融合分数与特征生成一致
- **连击确认**: 要求连续N个tick同向才确认信号（`min_consecutive_same_dir`）
- **反向防抖**: 提高`flip_rearm_margin`，抑制快速翻转
- **自适应冷却**: 提高`adaptive_cooldown_k`，延长冷却时间
- **迟滞机制**: 提高`entry_threshold`和`exit_threshold`，避免临界抖动

### 1.2 关键配置参数

```yaml
signal:
  recompute_fusion: true              # 回测端重算融合
  min_consecutive_same_dir: 4         # 连击确认（要求连续4个tick同向）
  dedupe_ms: 4000                     # 去重窗口（从1800提高到4000ms）

components:
  fusion:
    flip_rearm_margin: 0.45           # 翻转抑制（从0.35提高到0.45）
    adaptive_cooldown_k: 0.7           # 冷却系数（从0.5提高到0.7）

strategy:
  entry_threshold: 0.65               # 入场阈值（从0.6提高到0.65）
  exit_threshold: 0.45                 # 出场阈值（从0.4提高到0.45）

backtest:
  min_hold_time_sec: 240              # 最小持仓时间（从45提高到240秒）
  max_hold_time_sec: 3600             # 最大持仓时间保护
  ignore_gating_in_backtest: false    # 回测中启用门控
  deadband_bps: 2                      # 死区带（避免频繁进出）
```

---

## 二、历史测试数据

### 2.1 基线数据（深层修复验证前）

| 指标 | 基线值 |
|------|--------|
| **交易频率** | 934.0笔/小时 |
| **平均持仓** | 164.0秒 |
| **成本bps** | 1.93bps |
| **单笔收益** | -$0.82 |
| **胜率** | 16.81% |
| **总交易数** | 934笔 |

### 2.2 历史测试记录

#### 测试1: group_b_validation (2025-11-10 12:11, 12:37)
| 指标 | 结果 | 相对基线变化 |
|------|------|--------------|
| **交易频率** | 934.0笔/小时 | 0.0% |
| **平均持仓** | 164.0秒 | 0.0% |
| **成本bps** | 1.93bps | 0.0% |
| **单笔收益** | -$0.82 | 0.0% |
| **胜率** | 16.81% | 0.0% |
| **总交易数** | 934笔 |
| **综合评分** | 8.57 |

**问题**: 配置未生效，结果与基线完全相同

#### 测试2: group_b_fixed_validation (2025-11-10 13:55) - 修复后
| 指标 | 结果 | 相对基线变化 |
|------|------|--------------|
| **交易频率** | 593.0笔/小时 | -36.5% ⚠️ |
| **平均持仓** | 138.5秒 | -15.5% ❌ |
| **成本bps** | 1.93bps | 0.0% |
| **单笔收益** | -$0.83 | -1.2% |
| **胜率** | 21.59% | +28.4% ✅ |
| **总交易数** | 593笔 |
| **综合评分** | 15.40 |

**修复效果**: 
- ✅ 回测端重算融合已生效
- ✅ 连击确认逻辑已生效
- ⚠️ 交易频率下降36.5%（未达到40%目标）
- ❌ 平均持仓下降15.5%（未达到增加100%目标）

#### 测试3: group_b_optimized_validation (2025-11-10 15:18) - 优化后
| 指标 | 结果 | 相对基线变化 |
|------|------|--------------|
| **交易频率** | 82.0笔/小时 | -91.2% ✅ |
| **平均持仓** | 1706.5秒 | +940.5% ✅ |
| **成本bps** | 1.93bps | 0.0% |
| **单笔收益** | -$0.94 | -14.6% |
| **胜率** | 36.59% | +117.5% ✅ |
| **总交易数** | 82笔 |
| **综合评分** | 130.40 |

**优化效果**: 
- ✅ 交易频率大幅下降（91.2%），远超目标
- ✅ 平均持仓大幅提升（940.5%），远超目标
- ✅ 胜率大幅提升（117.5%）
- ⚠️ 冷却/连击确认拦截为0次（可能未正确记录）

---

## 三、最优配置分析

### 3.1 最优测试结果

**最优配置**: `group_b_optimized_validation` (2025-11-10 15:18)

| 指标 | 最优值 | 目标 | 状态 |
|------|--------|------|------|
| **交易频率** | 82.0笔/小时 | ↓≥40% | ✅ 达标（-91.2%） |
| **平均持仓** | 1706.5秒 | ↑≥100% | ✅ 达标（+940.5%） |
| **成本bps** | 1.93bps | - | ⚠️ 持平 |
| **单笔收益** | -$0.94 | ≥0 | ❌ 未达标 |
| **胜率** | 36.59% | - | ✅ 大幅提升（+117.5%） |

### 3.2 最优配置参数

基于最优测试结果，推荐配置：

```yaml
signal:
  recompute_fusion: true              # 回测端重算融合
  min_consecutive_same_dir: 4         # 连击确认（4个tick）
  dedupe_ms: 4000                     # 去重窗口

components:
  fusion:
    flip_rearm_margin: 0.45           # 翻转抑制
    adaptive_cooldown_k: 0.7           # 冷却系数

strategy:
  entry_threshold: 0.65               # 入场阈值
  exit_threshold: 0.45                 # 出场阈值

backtest:
  min_hold_time_sec: 240              # 最小持仓时间
  max_hold_time_sec: 3600             # 最大持仓时间保护
  ignore_gating_in_backtest: false    # 回测中启用门控
  deadband_bps: 2                      # 死区带
```

---

## 四、优化方向

### 4.1 当前问题

1. **冷却/连击确认拦截未记录**: gate_reason_breakdown为空
   - 原因：连击确认逻辑可能未正确记录gate_reason
   - 建议：检查`core_algo.py`中的连击确认逻辑

2. **成本bps未改善**: 1.93bps（与基线持平）
   - 原因：未结合Maker-first策略
   - 建议：结合C组的Maker-first策略

3. **单笔收益未达标**: -$0.94 vs 目标≥0
   - 原因：虽然胜率提升，但单笔亏损仍较大
   - 建议：优化TP/SL参数

### 4.2 优化建议

#### 方向1: 修复冷却/连击确认记录
- **检查`core_algo.py`**: 确保连击确认逻辑正确记录gate_reason
- **验证gate_reason_breakdown**: 确保正确生成统计文件
- **添加调试日志**: 追踪连击确认的触发情况

**预期效果**: 能够统计冷却/连击确认拦截次数

#### 方向2: 结合Maker-first成本优化
- **启用`fee_model: maker_taker`**: 参考C组配置
- **优化`scenario_probs`**: 提高Maker概率
- **添加`scenario标准化`**: 确保scenario正确匹配

**预期效果**: 成本bps下降至1.75bps以下

#### 方向3: 优化TP/SL参数
- **提高`take_profit_bps`**: 12 → 15或18
- **降低`stop_loss_bps`**: 10 → 8或6
- **优化`deadband_bps`**: 2 → 3或4

**预期效果**: 单笔收益提升至≥0

#### 方向4: 进一步强化冷却机制
- **提高`min_consecutive_same_dir`**: 4 → 5或6
- **提高`flip_rearm_margin`**: 0.45 → 0.50或0.55
- **提高`adaptive_cooldown_k`**: 0.7 → 0.8或0.9

**预期效果**: 进一步减少快速反转交易

---

## 五、下一步行动

### 5.1 立即行动

1. **修复冷却/连击确认记录**:
   - 检查`core_algo.py`中的连击确认逻辑
   - 确保gate_reason正确记录

2. **结合Maker-first成本优化**:
   - 启用`fee_model: maker_taker`
   - 优化`scenario_probs`配置

3. **优化TP/SL参数**:
   - 提高`take_profit_bps`到15
   - 降低`stop_loss_bps`到8

### 5.2 后续优化

1. **参数微调**: 根据验证结果进一步调整参数
2. **长时间验证**: 对最优配置运行4小时稳定性验证
3. **组合优化**: 尝试组合B+A或B+C，结合冷却和严门控/成本优化

---

## 六、关键指标总结

| 指标 | 基线 | 最优 | 变化 | 目标 | 状态 |
|------|------|------|------|------|------|
| **交易频率** | 934.0 | 82.0 | -91.2% | ↓≥40% | ✅ 达标 |
| **平均持仓** | 164.0 | 1706.5 | +940.5% | ↑≥100% | ✅ 达标 |
| **成本bps** | 1.93 | 1.93 | 0.0% | - | ⚠️ 持平 |
| **单笔收益** | -$0.82 | -$0.94 | -14.6% | ≥0 | ❌ 未达标 |
| **胜率** | 16.81% | 36.59% | +117.5% | - | ✅ 大幅提升 |

---

**报告生成时间**: 2025-11-10  
**报告版本**: v1.0

