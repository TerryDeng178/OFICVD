# TASK-07A LIVE模式60分钟测试重启报告

> **重启时间**: 2025-11-08 23:05  
> **原因**: harvest健康检查失败，清理旧数据后重新启动  
> **状态**: ⏳ **运行中**

---

## 1. 问题分析

### 1.1 原始问题

- **问题**: harvest进程健康检查失败
- **可能原因**:
  - 旧数据干扰（runtime目录、logs目录、artifacts目录）
  - 进程状态不一致
  - 文件锁定或资源冲突

### 1.2 解决方案

1. **停止所有Python进程**
2. **清理旧数据**:
   - `runtime/` 目录
   - `logs/` 目录
   - `deploy/artifacts/ofi_cvd/` 目录
3. **重新创建目录结构**
4. **重新启动60分钟测试**

---

## 2. 清理操作

### 2.1 清理脚本

已创建清理脚本：`scripts/cleanup_for_task07a.py`

**清理内容**:
- `runtime/` - 运行时数据（JSONL、SQLite等）
- `logs/` - 所有日志文件
- `deploy/artifacts/ofi_cvd/` - 所有产出物（run_manifest、source_manifest等）

**保留内容**:
- 配置文件（`config/`）
- 源代码（`src/`、`orchestrator/`、`mcp/`等）
- 数据源（`deploy/data/ofi_cvd/`）

### 2.2 清理结果

- ✅ 已删除 `runtime/` 目录
- ✅ 已删除 `logs/` 目录
- ✅ 已删除 `deploy/artifacts/ofi_cvd/` 目录
- ✅ 已重新创建必要的目录结构

---

## 3. 测试重启

### 3.1 测试配置

- **模式**: LIVE模式（`V13_REPLAY_MODE=0`）
- **Sink**: dual（JSONL + SQLite）
- **运行时长**: 60分钟
- **RUN_ID**: `task07a_live_YYYYMMDD_HHMMSS`（自动生成）

### 3.2 执行命令

```bash
python scripts/run_task07a_live_60min.py
```

### 3.3 测试脚本功能

`scripts/run_task07a_live_60min.py` 包含：

1. **环境变量设置**
   - LIVE模式配置
   - 时序库导出配置
   - RUN_ID生成

2. **时序库可达性预检**（可选）
   - Prometheus Pushgateway检查
   - InfluxDB健康检查

3. **运行60分钟测试**
   - 使用 `--sink dual`
   - 自动设置所有环境变量

4. **证据包验证**
   - 检查 `run_manifest.json` 字段完整性
   - 检查 `source_manifest.json` 是否存在
   - 运行双Sink等价性测试

---

## 4. 监控

### 4.1 监控脚本

已创建监控脚本：`scripts/monitor_task07a_live.py`

**监控内容**:
- 运行信息（RUN_ID、开始/结束时间、运行时长）
- 进程状态（running、health、restarts）
- 报告统计（总信号数、确认信号、强信号占比）
- TASK-07A必须项检查

### 4.2 实时监控

```bash
# 查看测试进度
python scripts/monitor_task07a_live.py

# 查看orchestrator日志
tail -f logs/orchestrator/orchestrator.log
```

---

## 5. 预期产出物

测试完成后（60分钟后），应生成：

1. **run_manifest.json**
   - 位置: `deploy/artifacts/ofi_cvd/run_logs/run_manifest_*.json`
   - 包含所有TASK-07A必须项字段

2. **source_manifest.json**
   - 位置: `deploy/artifacts/ofi_cvd/source_manifest_*.json`
   - 包含symbol列表、会话时间、WS端点、配置快照

3. **parity_diff.json**
   - 位置: `deploy/artifacts/ofi_cvd/parity_diff_*.json`
   - 双Sink等价性分析结果

4. **日报文件**
   - JSON: `logs/report/summary_*.json`
   - Markdown: `logs/report/summary_*.md`

---

## 6. 验证清单

测试完成后，需要验证：

### 6.1 核心功能
- [ ] 运行时长 ≥ 60分钟
- [ ] 所有进程健康状态为 `healthy`
- [ ] 信号产出正常

### 6.2 TASK-07A必须项
- [ ] 时序库导出统计（export_count ≥ 60, error_count = 0）
- [ ] 告警记录（alerts字段存在）
- [ ] Harvester SLO指标（queue_dropped=0, reconnect_count≤3）
- [ ] 资源使用（max_rss < 600MB, max_files < 256）
- [ ] 关闭顺序（shutdown_order字段存在）
- [ ] source_manifest.json（已生成且完整）

### 6.3 双Sink等价性
- [ ] 差异 < 0.5%（total/confirm/strong_ratio）
- [ ] parity_diff.json已生成
- [ ] 两份日报已生成

---

**报告生成时间**: 2025-11-08 23:05  
**测试状态**: ⏳ **运行中**  
**预计完成时间**: 60分钟后（约 00:05）

