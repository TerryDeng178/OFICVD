# TASK-08 ä¸‹ä¸€æ­¥æ”¹è¿›å®æ–½è¿›åº¦æŠ¥å‘Šï¼ˆv4.0.7ï¼‰

**æŠ¥å‘Šæ—¶é—´**: 2025-11-10  
**ç‰ˆæœ¬**: v4.0.7  
**çŠ¶æ€**: è¿›è¡Œä¸­

---

## ä¸€ã€å·²å®Œæˆé¡¹ï¼ˆ6é¡¹ï¼‰

### âœ… P1.1: Gateç»Ÿè®¡åŒè·‘åŸºçº¿ï¼ˆåŠ åˆ°CIï¼‰

**å®æ–½å†…å®¹**:
1. åˆ›å»º `scripts/extract_gate_stats_from_signals.py` è„šæœ¬ï¼Œä»JSONL/SQLiteä¿¡å·äº§ç‰©ä¸­æå–gateç»Ÿè®¡
2. æ›´æ–° `.github/workflows/gate-baseline.yml`ï¼Œæ·»åŠ gateç»Ÿè®¡æå–å’Œå¯¹æ¯”æ­¥éª¤
3. æ”¯æŒæŒ‰åœºæ™¯/æ¨¡å¼åˆ†æ¡¶å¯¹æ¯”ï¼ˆquiet/activeï¼‰
4. æ”¯æŒé˜ˆå€¼é…ç½®ï¼ˆé»˜è®¤3%ï¼‰

**æ–‡ä»¶å˜æ›´**:
- `scripts/extract_gate_stats_from_signals.py` (æ–°å»º)
- `.github/workflows/gate-baseline.yml` (æ›´æ–°)

---

### âœ… P1.2: PnLåˆ‡æ—¥ä¸æ—¶åŒºå›å½’æµ‹è¯•ï¼ˆè¡¥å……æ ·ä¾‹ï¼‰

**å®æ–½å†…å®¹**:
1. åœ¨ `tests/test_pnl_rollover_boundaries.py` ä¸­æ·»åŠ  `test_cross_timezone_consistency` æµ‹è¯•
2. åˆ›å»º `.github/workflows/pnl-rollover-tz.yml` CIå·¥ä½œæµ
3. éªŒè¯UTCå’ŒAsia/Tokyoæ—¶åŒºçš„åˆ‡æ—¥ä¸€è‡´æ€§

**æ–‡ä»¶å˜æ›´**:
- `tests/test_pnl_rollover_boundaries.py` (æ›´æ–°)
- `.github/workflows/pnl-rollover-tz.yml` (æ–°å»º)

---

### âœ… P1.3: æ»‘ç‚¹/è´¹ç”¨æƒ…å¢ƒåŒ–è½åœ°ï¼ˆMVPï¼‰

**å®æ–½å†…å®¹**:
1. åœ¨ `config/backtest.yaml` ä¸­æ·»åŠ  `slippage_piecewise` å’Œ `fee_tiered` é…ç½®
2. æ›´æ–° `src/alpha_core/backtest/trade_sim.py`ï¼Œæ”¯æŒä»é…ç½®è¯»å–åœºæ™¯å€æ•°å’Œè´¹ç‡è¡¨
3. å®ç°scenario_2x2 â†’ æ»‘ç‚¹bpsæ›²çº¿çš„piecewiseæ¨¡å‹
4. å®ç°fee_tier â†’ Maker/Takerè´¹ç‡è¡¨çš„tieredæ¨¡å‹

**æ–‡ä»¶å˜æ›´**:
- `config/backtest.yaml` (æ›´æ–°)
- `src/alpha_core/backtest/trade_sim.py` (æ›´æ–°)

---

### âœ… P1.4: è¾¹ç•Œå¯¹é½å›å½’ï¼ˆæ‰©å……åˆ†å±‚ç”¨ä¾‹ï¼‰

**å®æ–½å†…å®¹**:
1. åˆ›å»º `tests/test_alignment_boundary_extended.py`ï¼ŒåŒ…å«åˆ†å±‚ç”¨ä¾‹
2. å®ç°ç¬¦å·Ã—æ•°æ®æºÃ—æ—¶é—´çª—çš„å‚æ•°åŒ–æµ‹è¯•
3. æ·»åŠ æç«¯åœºæ™¯æµ‹è¯•ï¼ˆé«˜ä¸¢åŒ…ã€ä»·å·®éª¤å®½+é«˜æ³¢åŠ¨ï¼‰
4. æ·»åŠ Readeræºä¼˜å…ˆçº§å¤šsymboléªŒè¯

**æ–‡ä»¶å˜æ›´**:
- `tests/test_alignment_boundary_extended.py` (æ–°å»º)

---

### âœ… ä»£ç .1: Metricsæ¨é€è§„èŒƒåŒ–ï¼ˆPushgatewayï¼‰

**å®æ–½å†…å®¹**:
1. å°†Pushgatewayæ¨é€çš„æ—¶é—´æˆ³ä»æ¯«ç§’æ”¹ä¸ºç§’ï¼ˆé™ä½ä¹±åº/æŠ–åŠ¨é£é™©ï¼‰
2. æ·»åŠ instanceæ ‡ç­¾ï¼ˆä¸»æœºå+ç¯å¢ƒå˜é‡ï¼‰ï¼Œä¾¿äºå¤šæœºå¹¶è¡Œå›æµ‹èšåˆ
3. æ›´æ–°æ‰€æœ‰metricsçš„æ ‡ç­¾æ ¼å¼

**æ–‡ä»¶å˜æ›´**:
- `src/alpha_core/backtest/metrics.py` (æ›´æ–°)

---

### âœ… ä»£ç .2: Sharpe/Sortinoæ”¶ç›Šç‡å½’ä¸€

**å®æ–½å†…å®¹**:
1. åœ¨ `compute_metrics` ä¸­æ·»åŠ  `initial_equity` å‚æ•°
2. å°†PnLåºåˆ—è½¬æ¢ä¸ºæ—¥æ”¶ç›Šç‡åºåˆ—ï¼ˆåŸºäºequity_baseï¼‰
3. ä½¿ç”¨æ”¶ç›Šç‡åºåˆ—è®¡ç®—Sharpe/Sortinoï¼Œé¿å…"å•ä½ä¸ä¸€"çš„åå·®
4. æ›´æ–° `scripts/replay_harness.py` ä¼ é€’ `initial_equity` å’Œ `notional_per_trade`

**æ–‡ä»¶å˜æ›´**:
- `src/alpha_core/backtest/metrics.py` (æ›´æ–°)
- `scripts/replay_harness.py` (æ›´æ–°)

---

## äºŒã€å¾…å®æ–½é¡¹ï¼ˆ6é¡¹ï¼‰

### â³ ä»£ç .3: Readerå»é‡é›†å†…å­˜ä¼˜åŒ–

**è®¡åˆ’**:
- æŒ‰åˆ†é’Ÿæ¡¶ç»´æŠ¤ `_seen_keys`
- å¤„ç†å®Œæ¯ä¸ªæ–‡ä»¶åæ¸…ç†è¿‡æœŸæ¡¶
- é¿å…é•¿çª—å£å†…å­˜å ç”¨å¢é•¿

---

### â³ ä»£ç .4: Aligneré—¨é™å¤–ç½®åˆ°é…ç½®

**è®¡åˆ’**:
- å°† `lag_threshold_ms`, `spread_threshold`, `volatility_threshold` ç§»åˆ° `config_schema`
- æ”¯æŒé»˜è®¤å€¼ä¸ç¯å¢ƒå˜é‡è¦†ç›–
- ä¾¿äºç­–ç•¥åœºæ™¯åˆ‡æ¢æ—¶è”åŠ¨é˜ˆå€¼è°ƒå‚

---

### â³ ä»£ç .5: TradeSimæ”¶ç›˜æ¸…ä»“æ—¶é—´æˆ³

**è®¡åˆ’**:
- ä»¥æœ€åä¸€æ¡å¸‚åœºæ•°æ®tsä½œä¸º"æ—¥æœ«å¹³ä»“"æ—¶é—´
- åœ¨ `_feature_data.session` è¾…åŠ©åˆ¤æ–­æ”¶ç›˜è¾¹ç•Œ
- é¿å…åˆ‡æ—¥PnLè¢«å½“å‰æœºå™¨æ—¶é—´å½±å“

---

### â³ ä»£ç .6: Maker/Takerè´¹ç”¨æ¨¡å‹

**è®¡åˆ’**:
- åŸºäº `spread_bps/scenario_2x2` å†³å®šæˆäº¤è½ç‚¹æ¦‚ç‡
- "å®½&åŠ¨"åœºæ™¯æé«˜takeræ¦‚ç‡
- å½¢æˆåœºæ™¯åŒ–PnL

---

### â³ CI.1: æ–°å¢CIä½œä¸š

**è®¡åˆ’**:
- `gate-baseline.yml` å·²æ›´æ–°ï¼ˆP1.1ï¼‰
- `pnl-rollover-tz.yml` å·²åˆ›å»ºï¼ˆP1.2ï¼‰
- éœ€è¦éªŒè¯CIå·¥ä½œæµæ­£å¸¸è¿è¡Œ

---

### â³ CI.2: æ‰©å±•ç”¨ä¾‹

**è®¡åˆ’**:
- æç«¯åœºæ™¯æµ‹è¯•å·²æ·»åŠ ï¼ˆP1.4ï¼‰
- Readeræºä¼˜å…ˆçº§å¤šsymbolæµ‹è¯•å·²æ·»åŠ ï¼ˆP1.4ï¼‰
- éœ€è¦é›†æˆåˆ°CIå·¥ä½œæµ

---

## ä¸‰ã€æ€»ç»“

**å·²å®Œæˆ**: 6é¡¹ï¼ˆP1å…¨éƒ¨4é¡¹ + ä»£ç å±‚2é¡¹ï¼‰  
**å¾…å®æ–½**: 6é¡¹ï¼ˆä»£ç å±‚4é¡¹ + CI/æµ‹è¯•2é¡¹ï¼‰  
**è¿›åº¦**: 50%

**ä¸‹ä¸€æ­¥**:
1. ç»§ç»­å®æ–½ä»£ç å±‚æ”¹è¿›ï¼ˆä»£ç .3-6ï¼‰
2. éªŒè¯CIå·¥ä½œæµæ­£å¸¸è¿è¡Œ
3. ç”Ÿæˆæœ€ç»ˆå®æ–½æŠ¥å‘Š

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-10  
**çŠ¶æ€**: ğŸ“‹ è¿›è¡Œä¸­

