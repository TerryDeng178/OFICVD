# T3 Live Small Flow 配置文件
# TASK-A4: 测试网环境，启用交易执行，小流量单币

# 继承 defaults.yaml 的基础配置
# 可以通过环境变量或命令行参数覆盖

signal:
  # F1最佳参数（Trial 5）：提升交易质量
  dedupe_ms: 8000              # F1最佳：8000ms（原250ms，大幅提高以减少噪音）
  weak_signal_threshold: 0.76  # F1最佳：0.76（原0.15，大幅提高以过滤弱信号）
  consistency_min: 0.53        # F1最佳：0.53（原0.12，大幅提高以提升信号质量）
  min_consecutive_same_dir: 3  # F1最佳：3（连击确认，提升信号可靠性）
  consistency_min_per_regime:
    active: 0.50               # 基于F1最佳参数调整（原0.10）
    quiet: 0.55                # 基于F1最佳参数调整（原0.15）
  consistency_floor: 0.50      # 基于F1最佳参数调整（原0.10）
  consistency_floor_when_abs_score_ge: 0.45
  consistency_floor_on_divergence: 0.53  # 基于F1最佳参数调整（原0.15）
  spread_bps_cap: 20.0
  lag_cap_sec: 3.0
  weights:
    w_ofi: 0.6                 # 保持F系列实验常用值
    w_cvd: 0.4
  thresholds:
    base:
      buy: 0.6
      strong_buy: 1.2
      sell: -0.6
      strong_sell: -1.2
    active:
      buy: 1.2                 # F2最佳：1.2（原0.5，提高买入门槛）
      strong_buy: 1.5          # F2最佳：1.5（原1.0，提高强买入门槛）
      sell: -1.2               # F2最佳：-1.2（原-0.5，提高卖出门槛）
      strong_sell: -1.5        # F2最佳：-1.5（原-1.0，提高强卖出门槛）
    quiet:
      buy: 0.7
      strong_buy: 1.4
      sell: -0.7
      strong_sell: -1.4
  sink:
    kind: dual  # jsonl|sqlite|dual
    output_dir: ./runtime
  replay_mode: 0  # LIVE 模式
  debug: true

# TASK-A4: Signal v2 core.* 配置
use_signal_v2: true
core:
  expiry_ms: 60000         # 信号有效期（ms）
  cooldown_ms: 30000       # 方向级冷却（buy/sell 独立，ms）
  allow_quiet: false       # 是否允许 quiet regime
  gating:
    ofi_z: 1.5             # OFI z-score 门控阈值
    cvd_z: 1.2             # CVD z-score 门控阈值
    enable_divergence_alt: true   # 背离可作为门控替代路径
  threshold:
    entry:
      trend: 1.8           # trend regime 入场阈值
      revert: 2.2          # revert regime 入场阈值
      quiet: 2.8           # quiet regime 入场阈值
  regime:
    z_t: 1.2               # trend regime z-score 阈值
    z_r: 1.0               # revert regime z-score 阈值
  features_ver: "ofi/cvd v3"  # 特征版本（用于 config_hash）
  rules_ver: "core v1"        # 规则版本（用于 config_hash）

# Components配置（F系列实验优化参数）
components:
  fusion:
    w_ofi: 0.6             # F2实验常用值（保持）
    w_cvd: 0.4             # F2实验常用值（保持）
    min_consecutive: 3     # F1最佳：3（原默认1，提升信号可靠性）
    adaptive_cooldown_k: 1.0  # F2最佳：1.0（自适应冷却系数）
    flip_rearm_margin: 0.8    # F3最佳：0.8（反向防抖，抑制亏损翻手）

# Execution配置（F1最佳参数）
execution:
  cooldown_ms: 500         # F1最佳：500ms（执行层冷却时间）

# Executor 配置（测试网模式，小流量）
executor:
  mode: testnet            # 测试网模式
  sink: dual
  output_dir: ./runtime
  symbols: [BTCUSDT]       # 单币，小流量
  slippage_bps: 1.0
  fee_bps: 1.93
  max_parallel_orders: 2   # 低并发（小流量）
  order_size_usd: 50       # 小单量（USD）
  tif: GTC
  order_type: market
  enable_precheck: true    # 启用执行前置检查
  use_outbox: true         # 启用 Outbox 模式

# Adapter 配置
adapter:
  impl: testnet            # 测试网适配器
  rate_limit:
    place: { rps: 4, burst: 8 }   # 降低限流（小流量）
    cancel: { rps: 2, burst: 4 }
    query: { rps: 5, burst: 10 }
  max_inflight_orders: 8   # 降低并发（小流量）
  order_size_usd: 50
  tif: GTC
  order_type: market

# Broker 配置（测试网，但启用真实下单）
broker:
  name: binance-futures
  api_key_env: BINANCE_API_KEY
  secret_env: BINANCE_API_SECRET
  testnet: true            # 测试网环境
  dry_run: false           # 关闭 dry-run，真实下单（但仍是测试网）
  mock_enabled: false      # 使用真实测试网 API（不是 Mock）


