# -*- coding: utf-8 -*-
# CoreAlgorithm 信号参数调优 - 探索宽松配置 (Explore-relaxed)
# TASK_PARAM_CORE_TUNING: 用于参数网格搜索的宽松初始配置
# 目的: 为weak_signal_threshold × consistency_min网格搜索提供宽松起点
# 预期: strict模式下交易数应明显>30笔，为参数调优提供空间

signal:
  sink: jsonl  # jsonl | sqlite | null
  output_dir: ./runtime
  replay_mode: 1  # Always 1 for backtest

  # === 信号质量控制参数 (调优目标 - 宽松初始值) ===
  weak_signal_threshold: 0.15  # 弱信号阈值 - 比prod-like低 (0.20→0.15)
  consistency_min: 0.05  # 最小一致性要求 - 显著放宽 (0.15→0.05)
  consistency_min_per_regime:
    active: 0.05  # 活跃模式一致性阈值 - 显著放宽 (0.18→0.05)
    quiet: 0.08   # 静默模式一致性阈值 - 显著放宽 (0.12→0.08)
  min_consecutive_same_dir: 1  # 最小连续同向要求 - 固定为1，Phase B1先不调

  # === 其他信号参数 (保持默认) ===
  min_abs_score_for_side: 0.0  # 默认0.0，允许任何非零score决定方向
  thresholds:
    active:
      buy: 0.4
      sell: -0.4

components:
  fusion:
    w_ofi: 0.6
    w_cvd: 0.4
    adaptive_cooldown_k: 0.6
    flip_rearm_margin: 0.05
    min_consecutive: 3

  cvd:
    winsor_limit: 2.0

strategy:
  mode: active
  direction: both
  entry_threshold: 0.0
  exit_threshold: 0.0

execution:
  cooldown_ms: 500

risk:
  max_position_notional: 10000
  max_drawdown_bps: 2000
  gates:
    max_spread_bps: 2.5
    max_lag_sec: 0.5
    require_activity: true

aligner:
  lag_threshold_ms: 5000
  spread_threshold: 2.0
  volatility_threshold: 5.0

reader:
  dedup_keep_hours: 2

backtest:
  taker_fee_bps: 2.0
  slippage_bps: 1.0
  notional_per_trade: 1000
  reverse_on_signal: false
  take_profit_bps: null
  stop_loss_bps: null
  min_hold_time_sec: null
  ignore_gating_in_backtest: true
  rollover_timezone: "UTC"
  rollover_hour: 0
  slippage_model: "static"
  fee_model: "taker_static"

  slippage_piecewise:
    scenario_multipliers:
      A_H: 1.5
      A_L: 1.0
      Q_H: 1.5
      Q_L: 0.8
    spread_base_multiplier: 1.0

  fee_tiered:
    tier_mapping:
      TM: 2.0
      TK: 2.0
      MM: 1.0
      MK: 1.0

  fee_maker_taker:
    scenario_probs:
      Q_H: 0.2
      A_L: 0.8
      A_H: 0.4
      Q_L: 0.6
    spread_slope: 0.7
    spread_threshold_wide: 5.0
    spread_threshold_narrow: 1.0
    side_bias:
      buy: 1.2
      sell: 0.8
    maker_fee_ratio: 0.5

data:
  features_price_dir: "deploy/data/ofi_cvd"

paths:
  input_dir: ./deploy/data/ofi_cvd
  output_dir: ./runtime/backtest
